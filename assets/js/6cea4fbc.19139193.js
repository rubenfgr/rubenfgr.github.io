"use strict";(self.webpackChunkrubenfgr_website=self.webpackChunkrubenfgr_website||[]).push([[7167],{93:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>t});var s=n(4848),r=n(8453);const i={title:"Referencia"},o=void 0,c={id:"servers/protocols/SSH/0referencia",title:"Referencia",description:"Instalaci\xf3n de un servidor SSH",source:"@site/docs/servers/protocols/SSH/0referencia.md",sourceDirName:"servers/protocols/SSH",slug:"/servers/protocols/SSH/0referencia",permalink:"/docs/servers/protocols/SSH/0referencia",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Referencia"},sidebar:"tutorialSidebar",previous:{title:"EMQX",permalink:"/docs/servers/protocols/MQTT/emqx"},next:{title:"Sistemas",permalink:"/docs/category/sistemas"}},l={},t=[{value:"Instalaci\xf3n de un servidor SSH",id:"instalaci\xf3n-de-un-servidor-ssh",level:2},{value:"Autenticaci\xf3n con usuario y contrase\xf1a",id:"autenticaci\xf3n-con-usuario-y-contrase\xf1a",level:2},{value:"Ejercicio simple de acceso con usuario/contrase\xf1a",id:"ejercicio-simple-de-acceso-con-usuariocontrase\xf1a",level:3},{value:"Ejecuci\xf3n remota",id:"ejecuci\xf3n-remota",level:3},{value:"Consideraciones acerca de root",id:"consideraciones-acerca-de-root",level:3},{value:"Otras opciones",id:"otras-opciones",level:3},{value:"Autenticaci\xf3n con claves p\xfablica/privada con frase de paso",id:"autenticaci\xf3n-con-claves-p\xfablicaprivada-con-frase-de-paso",level:3},{value:"Creaci\xf3n de la clave privada",id:"creaci\xf3n-de-la-clave-privada",level:3},{value:"Copia de la clave p\xfablica en el equipo remoto",id:"copia-de-la-clave-p\xfablica-en-el-equipo-remoto",level:3},{value:"Clave privada con nombre no est\xe1ndar",id:"clave-privada-con-nombre-no-est\xe1ndar",level:3},{value:"Utilizaci\xf3n en cloud computing",id:"utilizaci\xf3n-en-cloud-computing",level:3},{value:"Generaci\xf3n de una clave p\xfablica a partir de la privada",id:"generaci\xf3n-de-una-clave-p\xfablica-a-partir-de-la-privada",level:3},{value:"Utilizaci\xf3n en procesos no interactivos",id:"utilizaci\xf3n-en-procesos-no-interactivos",level:3},{value:"Autenticaci\xf3n con claves p\xfablica/privada y frase de paso",id:"autenticaci\xf3n-con-claves-p\xfablicaprivada-y-frase-de-paso",level:2},{value:"SSH - Agent",id:"ssh---agent",level:2},{value:"A\xf1adir una clave privada a ssh-agent",id:"a\xf1adir-una-clave-privada-a-ssh-agent",level:3},{value:"Ejecuci\xf3n de ssh-agent",id:"ejecuci\xf3n-de-ssh-agent",level:3},{value:"Gesti\xf3n de ficheros: authorized_keys y known_hosts",id:"gesti\xf3n-de-ficheros-authorized_keys-y-known_hosts",level:2},{value:"Fichero ~/.ssh/authorized_keys",id:"fichero-sshauthorized_keys",level:3},{value:"Fichero ~/.ssh/known_hosts",id:"fichero-sshknown_hosts",level:3},{value:"Cambio de clave p\xfablica del servidor",id:"cambio-de-clave-p\xfablica-del-servidor",level:3},{value:"Forwarding",id:"forwarding",level:2},{value:"Configuraci\xf3n del cliente",id:"configuraci\xf3n-del-cliente",level:3},{value:"Algunos par\xe1metros significativos",id:"algunos-par\xe1metros-significativos",level:3},{value:"HashKnownHosts yes|no",id:"hashknownhosts-yesno",level:3},{value:"GSSAPIAuthentication yes|no",id:"gssapiauthentication-yesno",level:3},{value:"Car\xe1cter de escape",id:"car\xe1cter-de-escape",level:3},{value:"ForwardAgent, ForwardX11",id:"forwardagent-forwardx11",level:3},{value:"GlobalKnownHostsFile fichero",id:"globalknownhostsfile-fichero",level:3},{value:"NumberOfPasswordPrompts",id:"numberofpasswordprompts",level:3},{value:"StrictHostKeyChecking yes|ask|no",id:"stricthostkeychecking-yesaskno",level:3},{value:"UserKnownHostsFile fichero",id:"userknownhostsfile-fichero",level:3},{value:"Configuraci\xf3n por usuario",id:"configuraci\xf3n-por-usuario",level:3},{value:"Utilizar par\xe1metros directamente",id:"utilizar-par\xe1metros-directamente",level:3},{value:"Configuraci\xf3n del servidor",id:"configuraci\xf3n-del-servidor",level:2},{value:"Port 22",id:"port-22",level:3},{value:"AddressFamily any|inet|inet6",id:"addressfamily-anyinetinet6",level:3},{value:"ListenAddress",id:"listenaddress",level:3},{value:"logingracetime, maxauthtries y maxsessions",id:"logingracetime-maxauthtries-y-maxsessions",level:3},{value:"loglevel y syslogfacility",id:"loglevel-y-syslogfacility",level:3},{value:"hostkey",id:"hostkey",level:3},{value:"Utilizaci\xf3n de SCP",id:"utilizaci\xf3n-de-scp",level:2},{value:"Transferir un fichero local a un equipo remoto",id:"transferir-un-fichero-local-a-un-equipo-remoto",level:3},{value:"Transferir un fichero desde un equipo remoto a mi equipo local",id:"transferir-un-fichero-desde-un-equipo-remoto-a-mi-equipo-local",level:3},{value:"Transferir un fichero entre dos equipos remotos",id:"transferir-un-fichero-entre-dos-equipos-remotos",level:3},{value:"Bonus track",id:"bonus-track",level:3},{value:"SFTP",id:"sftp",level:2},{value:"T\xfaneles SSH",id:"t\xfaneles-ssh",level:2},{value:"Local forwarding",id:"local-forwarding",level:3},{value:"Remote forwarding",id:"remote-forwarding",level:3},{value:"Forwarding din\xe1mico",id:"forwarding-din\xe1mico",level:3}];function d(e){const a={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.h2,{id:"instalaci\xf3n-de-un-servidor-ssh",children:"Instalaci\xf3n de un servidor SSH"}),"\n",(0,s.jsx)(a.p,{children:"Habitualmente los equipos con alguna variedad de GNU/Linux traen un servidor ssh instalado, en el caso de los sistemas Debian y derivados el paquete que proporciona el servidor ssh se llama openssh-server. Podemos comprobar si ya est\xe1 instalado mediante la instrucci\xf3n:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"dpkg -l |grep openssh-server\r\nii  openssh-server            ......\n"})}),"\n",(0,s.jsx)(a.p,{children:"El fichero de configuraci\xf3n de este servicio se encuentra habitualmente en /etc/ssh/sshd_config y contiene las opciones de configuraci\xf3n."}),"\n",(0,s.jsx)(a.p,{children:"Las opciones aplicadas las obtendr\xedamos mediante:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"grep -v '^$\\|^#' /etc/ssh/sshd_config\r\n\r\nChallengeResponseAuthentication no\r\nUsePAM yes\r\nX11Forwarding yes\r\nPrintMotd no\r\nAcceptEnv LANG LC_*\r\nSubsystem    sftp    /usr/lib/openssh/sftp-server\n"})}),"\n",(0,s.jsx)(a.p,{children:"Sin embargo, en el caso de ssh hay muchas opciones que no vienen definidas y que se asume un valor por defecto, lo que puede resultar confuso. Sin embargo podemos utilizar la opci\xf3n \u201c-T: extended test mode\u201d que comprueba la validez del fichero de configuraci\xf3n y muestra las opciones efectivas que se aplican (las que est\xe1n habilitadas de forma expl\xedcita y las que tienen valores por defecto (en sistemas GNU/linux sshd s\xf3lo puede ejecutarlo un usuario privilegiado):"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"sshd -T\r\n...\r\nport 22\r\naddressfamily any\r\nlistenaddress [::]:22\r\nlistenaddress 0.0.0.0:22\r\nusepam yes\r\nlogingracetime 120\r\nx11displayoffset 10\r\nmaxauthtries 6\r\nmaxsessions 10\r\nclientaliveinterval 120\r\nclientalivecountmax 3\r\nstreamlocalbindmask 0177\r\npermitrootlogin without-password\r\nignorerhosts yes\r\nignoreuserknownhosts no\r\nhostbasedauthentication no\r\nhostbasedusesnamefrompacketonly no\r\npubkeyauthentication yes\r\nkerberosauthentication no\r\nkerberosorlocalpasswd yes\r\nkerberosticketcleanup yes\r\ngssapiauthentication no\r\ngssapikeyexchange no\r\ngssapicleanupcredentials yes\r\ngssapistrictacceptorcheck yes\r\ngssapistorecredentialsonrekey no\r\npasswordauthentication yes\r\nkbdinteractiveauthentication no\r\nchallengeresponseauthentication no\r\nprintmotd no\r\nprintlastlog yes\r\nx11forwarding yes\r\nx11uselocalhost yes\r\npermittty yes\r\npermituserrc yes\r\nstrictmodes yes\r\ntcpkeepalive yes\r\npermitemptypasswords no\r\npermituserenvironment no\r\ncompression yes\r\ngatewayports no\r\nusedns no\r\nallowtcpforwarding yes\r\nallowagentforwarding yes\r\ndisableforwarding no\r\nallowstreamlocalforwarding yes\r\nstreamlocalbindunlink no\r\nuseprivilegeseparation sandbox\r\nfingerprinthash SHA256\r\npidfile /run/sshd.pid\r\nxauthlocation /usr/bin/xauth\r\nciphers chacha20-poly1305@openssh.com,aes128-ctr, ...\r\nmacs umac-64-etm@openssh.com,umac-128-etm@openssh.com, ...\r\nversionaddendum none\r\nkexalgorithms curve25519-sha256,curve25519-sha256@libssh.org, ...\r\nhostbasedacceptedkeytypes ecdsa-sha2-nistp256-cert-v01@openssh.com, ...\r\nhostkeyalgorithms ecdsa-sha2-nistp256-cert-v01@openssh.com, ...\r\npubkeyacceptedkeytypes ecdsa-sha2-nistp256-cert-v01@openssh.com, ...\r\nloglevel INFO\r\nsyslogfacility AUTH\r\nauthorizedkeysfile .ssh/authorized_keys .ssh/authorized_keys2\r\nhostkey /etc/ssh/ssh_host_rsa_key\r\nhostkey /etc/ssh/ssh_host_ecdsa_key\r\nhostkey /etc/ssh/ssh_host_ed25519_key\r\nacceptenv LANG\r\nacceptenv LC_*\r\nauthenticationmethods any\r\nsubsystem sftp /usr/lib/openssh/sftp-server\r\nmaxstartups 10:30:100\r\npermittunnel no\r\nipqos lowdelay throughput\r\nrekeylimit 0 0\r\npermitopen any\n"})}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"autenticaci\xf3n-con-usuario-y-contrase\xf1a",children:"Autenticaci\xf3n con usuario y contrase\xf1a"}),"\n",(0,s.jsx)(a.p,{children:"El m\xe9todo inicial de autenticaci\xf3n es utilizando los usuarios del sistema y las contrase\xf1as que tienen almacenadas en el sistema. A SSH no le afecta la forma en la que el sistema almacena las contrase\xf1as, entra en la forma en la que se almacenan las contrase\xf1as (fichero, LDAP, etc.)."}),"\n",(0,s.jsx)(a.p,{children:"Las opciones de configuraci\xf3n que afectan en este caso son las siguientes:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"passwordauthentication yes|no\r\nchallengeresponseauthentication yes|no\r\npermitemptypasswords yes|no\n"})}),"\n",(0,s.jsx)(a.p,{children:"Te\xf3ricamente challengeresponseauthentication es un mecanismo m\xe1s complejo que permite preguntar al usuario otras cuestiones, no s\xf3lo la contrase\xf1a, pero en la pr\xe1ctica se suele preguntar la contrase\xf1a."}),"\n",(0,s.jsx)(a.p,{children:"En sistemas GNU/Linux se a\xf1ade la opci\xf3n"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:"usepam yes"}),"\r\nQue permite utilizar el subsistema PAM como mecanismo de autenticaci\xf3n."]}),"\n",(0,s.jsx)(a.h3,{id:"ejercicio-simple-de-acceso-con-usuariocontrase\xf1a",children:"Ejercicio simple de acceso con usuario/contrase\xf1a"}),"\n",(0,s.jsx)(a.p,{children:"Accedemos a un servidor remoto con:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh usuario@172.22.200.175\r\nThe authenticity of host '172.22.200.175 (172.22.200.175)' can't be established.\r\nECDSA key fingerprint is SHA256:Bsv9OS7Qf94ANguOiDLNPHn7J+XlwisWZydmfqa4QMo.\r\nAre you sure you want to continue connecting (yes/no)?\n"})}),"\n",(0,s.jsx)(a.p,{children:"Para verificar el servidor, en lugar de mostrarnos la clave p\xfablica completa, nos muestra la huella (fingerprint) de la clave p\xfablica del servidor, que no es m\xe1s que un hash de la clave p\xfablica, en este caso utlizando SHA256. Podemos comprobar la correspondencia entre la clave p\xfablica y la huella mediante la instrucci\xf3n:"}),"\n",(0,s.jsx)(a.p,{children:"ssh-keygen -l -E sha256 -f fichero_con_clave_publica\r\nPodr\xedamos hablar con detalle de la forma efectiva de verificar las claves p\xfablicas, pero en este momento aceptamos la clave que se nos ofrece y por tanto tecleamos \u201cyes\u201d y a continuaci\xf3n nos pide la contrase\xf1a de acceso, la introducimos y accedemos a una shell en el equipo remoto:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"Warning: Permanently added '172.22.200.175' (ECDSA) to the list of known hosts.\r\nusuario@172.22.200.175's password: **********\r\nLast login: Fri Feb 16 17:34:41 2018 from 172.23.0.22\r\nusuario@host:~$\n"})}),"\n",(0,s.jsx)(a.h3,{id:"ejecuci\xf3n-remota",children:"Ejecuci\xf3n remota"}),"\n",(0,s.jsxs)(a.p,{children:["SSH permite ejecutar una orden remotamente de forma no interactiva, lo que resulta muy c\xf3modo cuando hay que realizar tareas muy espec\xedficas en un equipo remoto. Por ejemplo:\r\n",(0,s.jsx)(a.code,{children:"ssh usuario@172.22.200.175 sudo apt update"})]}),"\n",(0,s.jsxs)(a.p,{children:["Tambi\xe9n se pueden encadenar varias \xf3rdenes o ejecutar un script:\r\n",(0,s.jsx)(a.code,{children:"ssh usuario@172.22.200.175 'sudo apt update && sudo apt upgrade'"})]}),"\n",(0,s.jsx)(a.h3,{id:"consideraciones-acerca-de-root",children:"Consideraciones acerca de root"}),"\n",(0,s.jsx)(a.p,{children:"Se puede restringir el acceso con el usuario root utilizando contrase\xf1a, aspecto importante desde el punto de vista de seguridad, por lo que hoy en d\xeda habitualmente se utiliza la opcion:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"PermitRootLogin without-password"})}),"\n",(0,s.jsx)(a.p,{children:"En caso de que quisi\xe9ramos permitir acceder con el usuario root y contrase\xf1a, deber\xedamos poner esta opci\xf3n a \u201cyes\u201d."}),"\n",(0,s.jsx)(a.h3,{id:"otras-opciones",children:"Otras opciones"}),"\n",(0,s.jsx)(a.p,{children:"No espec\xedficas del acceso con usuario y contrase\xf1a, pero adecuadas para empezar:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"PrintLastLog yes|no\r\nPrintMotd yes|no\r\nBanner Ruta_a_fichero\n"})}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h3,{id:"autenticaci\xf3n-con-claves-p\xfablicaprivada-con-frase-de-paso",children:"Autenticaci\xf3n con claves p\xfablica/privada con frase de paso"}),"\n",(0,s.jsx)(a.p,{children:"Aunque el mecanismo m\xe1s f\xe1cil de entender al utilizar ssh es la autenticaci\xf3n del usuario mediante la contrase\xf1a en el equipo remoto, el mecanismo m\xe1s \u201cnatural\u201d y probablemente m\xe1s habitual es la autenticaci\xf3n mediante un par de claves p\xfablica/privada."}),"\n",(0,s.jsx)(a.h3,{id:"creaci\xf3n-de-la-clave-privada",children:"Creaci\xf3n de la clave privada"}),"\n",(0,s.jsx)(a.p,{children:"Para crear la clave privada utilizaremos la herramienta ssh-keygen, especificando el algoritmo que deseamos utilizar mediante el par\xe1metro -t (dsa | ecdsa | ed25519 | rsa | rsa1), por ejemplo:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-keygen -t ecdsa"})}),"\n",(0,s.jsx)(a.p,{children:"Se crear\xe1 un di\xe1logo mediante el cual nos pedir\xe1 una frase de paso para proteger la clave privada, paso que ignoraremos de momento y explicaremos con detalle en la siguiente secci\xf3n:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"Generating public/private ecdsa key pair.\r\nEnter file in which to save the key (/home/alberto/.ssh/id_ecdsa): [ENTER]\r\nEnter passphrase (empty for no passphrase): [ENTER]\r\nEnter same passphrase again: [ENTER]\r\nYour identification has been saved in /home/alberto/.ssh/id_ecdsa.\r\nYour public key has been saved in /home/alberto/.ssh/id_ecdsa.pub.\r\nThe key fingerprint is:\r\nSHA256:QQ0bm3FBXKhLyWUfa7teeHgufwLPdK8nIu0UlMCJ6/M alberto@mut\r\nThe key's randomart image is:\r\n+---[ECDSA 256]---+\r\n|        =B==.    |\r\n|       ..BO...   |\r\n|       .=* .oo   |\r\n|        *. .+    |\r\n|       oS. ...   |\r\n|        +   o+. .|\r\n|         o .+*+..|\r\n|          E.=== +|\r\n|           +o++* |\r\n+----[SHA256]-----+\n"})}),"\n",(0,s.jsx)(a.p,{children:"En este caso hemos optado por dejar el nombre de la clave por defecto (~/.ssh/id_ecdsa). Si vamos al directorio ~/.ssh veremos que existen dos nuevos ficheros, que se corresponden con la clave p\xfablica y la privada:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"-rw------- 1 alberto alberto   227 feb 18 09:16 id_ecdsa\r\n-rw-r--r-- 1 alberto alberto   173 feb 18 09:16 id_ecdsa.pub\n"})}),"\n",(0,s.jsx)(a.p,{children:"L\xf3gicamente la clave privada se ha protegido en el sistema de forma que s\xf3lo el propietario puede leerla o modificarla, mientras que la p\xfablica puede leerla cualquier usuario y en general podr\xe1 estar accesible en cualquier sitio sin restricciones, ya que no es posible obtener la clave privada a partir de ella."}),"\n",(0,s.jsx)(a.p,{children:"Vemos el contenido de estas claves (obviamente se muestran aqu\xed a modo de ejemplo y se trata de claves que no se van a utilizar nunca en un entorno real):"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"~/.ssh/id_ecdsa\r\n-----BEGIN EC PRIVATE KEY-----\r\nMHcCAQEEIN53r8/ghcQ94wjNPtvz0VvSFsuU7ePsPkriWPhpC137oAoGCCqGSM49\r\nAwEHoUQDQgAEXJKU4yRlIdnKGG8qQA2PXpfCPVz9xpbB3TXOh9ymC9XtjgP3ZCwU\r\ntdNnLTQNJm8PO4MHtFZBTxeFE39lD7WVYQ==\r\n-----END EC PRIVATE KEY-----\r\n\r\n~/.ssh/id_ecdsa.pub\r\necdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAy\\\r\nNTYAAABBBFySlOMkZSHZyhhvKkANj16Xwj1c/caWwd01zofcpgvV7Y4D92QsFLXT\\\r\nZy00DSZvDzuDB7RWQU8XhRN/ZQ+1lWE= alberto@mut\n"})}),"\n",(0,s.jsx)(a.h3,{id:"copia-de-la-clave-p\xfablica-en-el-equipo-remoto",children:"Copia de la clave p\xfablica en el equipo remoto"}),"\n",(0,s.jsx)(a.p,{children:"Para que se pueda utilizar este mecanismo de autenticaci\xf3n es preciso que la clave p\xfablica del usuario se encuentre en la cuenta que \xe9ste posee en el equipo remoto, de forma m\xe1s concreta, dentro del fichero ~/.ssh/authorized_keys, por lo que debemos utilizar alg\xfan m\xe9todo para ubicarla all\xed:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Accedemos con contrase\xf1a y copiamos y pegamos la clave p\xfablica"}),"\n",(0,s.jsx)(a.li,{children:"Accedemos con otra clave p\xfablica que hubi\xe9semos copiado previamente y pegamos la nueva clave p\xfablica"}),"\n",(0,s.jsx)(a.li,{children:"Utilizamos cualquier sistema en el arranque de la m\xe1quina que obtenga la clave p\xfablica y la ubique en su sitio (muy habitual en cloud computing)"}),"\n",(0,s.jsx)(a.li,{children:"Utilizamos la herramienta ssh-copy-id\r\nVamos a ver el \xfaltimo m\xe9todo:"}),"\n"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:'ssh-copy-id -i ~/.ssh/id_ecdsa debian@172.22.200.175\r\n\r\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/alberto/.ssh/id_ecdsa.pub"\r\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\r\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\r\ndebian@172.22.200.175\'s password:\r\n\r\nNumber of key(s) added: 1\r\n\r\nNow try logging into the machine, with:   "ssh \'debian@172.22.200.175\'"\r\nand check to make sure that only the key(s) you wanted were added.\n'})}),"\n",(0,s.jsx)(a.p,{children:"Si accedemos al equipo remoto, podremos comprobar que la clave p\xfablica que hemos exportado se encuentra en el fichero ~/.ssh/authorized_keys."}),"\n",(0,s.jsx)(a.h3,{id:"clave-privada-con-nombre-no-est\xe1ndar",children:"Clave privada con nombre no est\xe1ndar"}),"\n",(0,s.jsx)(a.p,{children:"En el caso anterior hemos creado un par de claves con nombre est\xe1ndar (id_ecdsa e id_ecdsa.pub), pero es posible definir cualquier nombre a la hora de crear el par de claves, por ejemplo:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-keygen -t ed25519\r\nGenerating public/private ed25519 key pair.\r\nEnter file in which to save the key (/home/debian/.ssh/id_ed25519): openwebinars\r\nEnter passphrase (empty for no passphrase):\r\nEnter same passphrase again:\r\nYour identification has been saved in openwebinars.\r\nYour public key has been saved in openwebinars.pub.\r\nThe key fingerprint is:\r\nSHA256:HzEVg7wVelxLpuHrv+BUG8QG4bI0AsED7PnUvzFdlCI debian@asd\r\nThe key's randomart image is:\r\n+--[ED25519 256]--+\r\n|   ..oo. . .O++. |\r\n|    . o.  E*oXo. |\r\n|   . . o. B+*o=  |\r\n|    o . .o.B +.  |\r\n|     o  S.o...o  |\r\n|      .  .+o.. o |\r\n|          .++ .  |\r\n|          .o o   |\r\n|            . o. |\r\n+----[SHA256]-----+\n"})}),"\n",(0,s.jsx)(a.p,{children:"Proceder\xedamos de igual forma que en el caso anterior, aunque ahora para utilizar la clave en cualquier sesi\xf3n ssh, deber\xedamos indicarlo de forma expl\xedcita:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh -i ~/.ssh/openwebinars debian@172.22.200.175\n"})}),"\n",(0,s.jsx)(a.h3,{id:"utilizaci\xf3n-en-cloud-computing",children:"Utilizaci\xf3n en cloud computing"}),"\n",(0,s.jsx)(a.p,{children:"Hoy en d\xeda es cada vez m\xe1s habitual la utilizaci\xf3n de m\xe1quinas virtuales en alg\xfan proveedor de nube de infraestructura p\xfablica o privada (AWS, Azure, OpenStack, etc.), en estos casos es imprescindible utilizar este mecanismo de clave p\xfablica/privada para acceder a estas m\xe1quinas virtuales."}),"\n",(0,s.jsx)(a.h3,{id:"generaci\xf3n-de-una-clave-p\xfablica-a-partir-de-la-privada",children:"Generaci\xf3n de una clave p\xfablica a partir de la privada"}),"\n",(0,s.jsx)(a.p,{children:"Aunque habitualmente se generan ambas claves, en diferentes circunstancias puede ocurrir que tengamos la clave privada, pero no la correspondiente clave p\xfablica, en ese caso podemos utilizar ssh-keygen para obtenerla:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-keygen -y -f clave >> clave.pub\n"})}),"\n",(0,s.jsx)(a.p,{children:"Evidentemente si tenemos la clave p\xfablica y no la privada, no podemos hacer el proceso inverso."}),"\n",(0,s.jsx)(a.h3,{id:"utilizaci\xf3n-en-procesos-no-interactivos",children:"Utilizaci\xf3n en procesos no interactivos"}),"\n",(0,s.jsx)(a.p,{children:"Puesto que teniendo acceso a la clave privada el acceso se puede realizar al equipo remoto sin ninguna intervenci\xf3n, este mecanismo es ideal para su utilizaci\xf3n en procesos que no requieran intervenci\xf3n humana, como muchas conexiones que pueden realizarse entre diferentes equipos. La conexi\xf3n es segura y autenticada, aunque es muy importante custodiar adecuadamente las claves privadas."}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"autenticaci\xf3n-con-claves-p\xfablicaprivada-y-frase-de-paso",children:"Autenticaci\xf3n con claves p\xfablica/privada y frase de paso"}),"\n",(0,s.jsx)(a.p,{children:"La autenticaci\xf3n con clave privada tiene importantes ventajas respecto al acceso con contrase\xf1a, pero tiene el inconveniente de la custodia de la clave privada. Cualquier usuario que obtuviese nuestra clave privada podr\xeda entrar en nuestra cuenta de cualquier equipo en el que tuvi\xe9semos exportada la correspondiente clave p\xfablica. Para aumentar la seguridad en esta situaci\xf3n se utiliza una frase de paso para proteger la clave privada, frase que se introduce al crear la clave privada o que puede modificarse a posteriori. Vamos a crear una nueva clave, pero en este caso protegida con frase de paso:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-keygen -t ecdsa\r\nGenerating public/private ecdsa key pair.\r\nEnter file in which to save the key (/home/alberto/.ssh/id_ecdsa):\r\nEnter passphrase (empty for no passphrase): <- Teclear frase de paso\r\nEnter same passphrase again: <- Teclear frase de paso\r\nYour identification has been saved in /home/alberto/.ssh/id_ecdsa.\r\nYour public key has been saved in /home/alberto/.ssh/id_ecdsa.pub.\r\nThe key fingerprint is:\r\nSHA256:mvCLrZMvdUDOorOkvd/1iosAZmhGS2fWPQmjAVMjjtk alberto@mut\r\nThe key's randomart image is:\r\n+---[ECDSA 256]---+\r\n| +o+ o           |\r\n|ooo = = .        |\r\n|o+E= = +         |\r\n|+ = . + .        |\r\n|o* ... .S        |\r\n|=.+  o.o.        |\r\n| +.o o+..        |\r\n|. o.+= + .       |\r\n|  .o==B....      |\r\n+----[SHA256]-----+\n"})}),"\n",(0,s.jsx)(a.p,{children:"De esta forma la clave privada no es \xfatil a menos que se conozca la frase de paso."}),"\n",(0,s.jsx)(a.p,{children:"Procedemos de igual forma que en el caso anterior, exportando la clave p\xfablica, aunque ahora cada vez que accedamos nos solicitar\xe1 la frase de paso de la clave privada:"}),"\n",(0,s.jsx)(a.p,{children:"ssh -i ~/.ssh/id_ecdsa debian@172.22.200.175\r\nEnter passphrase for key '/home/alberto/.ssh/id_ecdsa':\r\nHemos ganado en seguridad, pero hemos perdido en usabilidad, porque ahora tenemos que escribir la frase de paso cada vez que accedamos al equipo remoto y adem\xe1s no es v\xe1lido para procesos no interactivos. Para solucionar este inconveniente usaremos ssh-agent en una secci\xf3n posterior."}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"ssh---agent",children:"SSH - Agent"}),"\n",(0,s.jsx)(a.p,{children:"Activar SSH-Agent"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:'eval "$(ssh-agent -s)"\r\nssh-keygen -t rsa -m PEM -f <nombre-clave>\r\nssh-copy-id -i ~/.ssh/id_ecdsa debian@172.22.200.175\n'})}),"\n",(0,s.jsx)(a.p,{children:"ssh-agent es un programa que permite almacenar las claves privadas de una sesi\xf3n y es muy \xfatil cuando usamos claves con frase de paso, ya que podemos a\xf1adir la clave privada al agente ssh y s\xf3lo tendremos que poner la frase de paso una vez, permitiendo utilizar ssh de forma transparente sin volver a introducir la frase de paso todo el tiempo que dure la sesi\xf3n del usuario (realmente se puede limitar a una cantidad de tiempo menor si se desea)."}),"\n",(0,s.jsx)(a.p,{children:"ssh-agent se suele ejecutar autom\xe1ticamente en las sesiones gr\xe1ficas de los sistemas, como podemos verificar mediante:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"env |grep SSH\r\n...\r\nSSH_AUTH_SOCK=/run/user/1001/keyring/ssh\r\nSSH_AGENT_PID=2743\n"})}),"\n",(0,s.jsx)(a.p,{children:"O a trav\xe9s de ps:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ps aux |grep ssh-agent\r\nalberto   2743  .... ..... 0:00 /usr/bin/ssh-agent x-session-manager\n"})}),"\n",(0,s.jsx)(a.p,{children:"De hecho, si tuvi\xe9ramos alguna clave privada sin frase de paso se habr\xeda cargado autom\xe1ticamente en el agente ssh y podr\xedamos utilizarla de forma totalmente transparente."}),"\n",(0,s.jsx)(a.h3,{id:"a\xf1adir-una-clave-privada-a-ssh-agent",children:"A\xf1adir una clave privada a ssh-agent"}),"\n",(0,s.jsx)(a.p,{children:"Mediante la herramienta ssh-add podemos a\xf1adir una clave al agente ssh, por ejemplo:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-add ~/.ssh/openwebinars\n"})}),"\n",(0,s.jsx)(a.p,{children:"Si la clave est\xe1 protegida por una frase de paso, se nos pedir\xe1 en ese momento, o se utilizar\xe1 la aplicaci\xf3n ssh-askpass si se tratase de una aplicaci\xf3n gr\xe1fica u otra que no tuviese asociada una terminal."}),"\n",(0,s.jsx)(a.p,{children:"Podemos ver las claves cargadas mediante:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-add -L"})}),"\n",(0,s.jsx)(a.p,{children:"Y sus huellas con:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-add -l"})}),"\n",(0,s.jsx)(a.p,{children:"ssh-agent permite que cualquier otra aplicaci\xf3n de la misma sesi\xf3n utilice las claves privadas que almacena sin tener que volver a autenticarse, por lo que es importante controlar el uso de la sesi\xf3n, bloque\xe1ndola cuando no se est\xe9 usando."}),"\n",(0,s.jsx)(a.p,{children:"Se pueden eliminar claves ssh del agente mediante:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-add -d openwebinars"})}),"\n",(0,s.jsx)(a.p,{children:"O incluso eliminar todas las claves con:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-add -D"})}),"\n",(0,s.jsx)(a.h3,{id:"ejecuci\xf3n-de-ssh-agent",children:"Ejecuci\xf3n de ssh-agent"}),"\n",(0,s.jsx)(a.p,{children:"En el caso de que utilicemos un sistema que no haya cargado autom\xe1ticamente un agente ssh, podemos ejecutarlo directamente, habitualmente se har\xeda abriendo una nueva shell:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-agent /bin/bash"})}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"gesti\xf3n-de-ficheros-authorized_keys-y-known_hosts",children:"Gesti\xf3n de ficheros: authorized_keys y known_hosts"}),"\n",(0,s.jsx)(a.h3,{id:"fichero-sshauthorized_keys",children:"Fichero ~/.ssh/authorized_keys"}),"\n",(0,s.jsx)(a.p,{children:"Se almacenan las claves p\xfablicas de los usuarios que pueden acceder a esta cuenta mediante clave p\xfablica/clave privada, el formato es:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"algoritmo clave_publica comentario"})}),"\n",(0,s.jsx)(a.p,{children:"Por ejemplo:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh-rsa AAAAB3NzaC1yc2EAA...dPh alberto@mut"})}),"\n",(0,s.jsx)(a.p,{children:"Si queremos que utilizar un par de claves para acceder a un equipo, debemos asegurarnos de que exista la clave p\xfablica en este fichero y cuando ya dejemos de utilizarla debemos borrar la l\xednea correspondiente."}),"\n",(0,s.jsx)(a.h3,{id:"fichero-sshknown_hosts",children:"Fichero ~/.ssh/known_hosts"}),"\n",(0,s.jsx)(a.p,{children:"Se almacenan las claves p\xfablicas de todos los equipos remotos a los que nos hemos conectado y que hemos aceptado, el formato es:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"nombre_o_IP_equipo algoritmo clave_p\xfablica"})}),"\n",(0,s.jsx)(a.p,{children:"Actualmente es m\xe1s habitual que no se guarde el nombre o direcci\xf3n IP del equipo en claro, sino que se almacene el hash. Para encontrar un determinado equipo por nombre o direcci\xf3n IP podemos utilizar la instrucci\xf3n:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-keygen -F 172.22.200.175\r\n# Host 172.22.200.175 found: line 88\r\n|1|lbA....9Lo= ecdsa-sha2-nistp256 AAAA.....ynTO90=\n"})}),"\n",(0,s.jsx)(a.h3,{id:"cambio-de-clave-p\xfablica-del-servidor",children:"Cambio de clave p\xfablica del servidor"}),"\n",(0,s.jsx)(a.p,{children:"Habitualmente se almacenan las claves p\xfablicas de los servidores a los que nos hemos conectado previamente en el fichero ~/.ssh/known_hosts, por lo que se verifica cada vez que se conecta que el servidor ofrece la misma clave p\xfablica. En caso de que no coincida veremos el siguiente mensaje:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:'ssh debian@172.22.200.175\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\r\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\r\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\r\nIt is also possible that a host key has just been changed.\r\nThe fingerprint for the ECDSA key sent by the remote host is\r\nSHA256:J9CMWSbavkqECRI1KWhy8s/D7UVJWDiysAocAbo1F6k.\r\nPlease contact your system administrator.\r\nAdd correct host key in /home/alberto/.ssh/known_hosts to get rid of this message.\r\nOffending ECDSA key in /home/alberto/.ssh/known_hosts:88\r\n  remove with:\r\n  ssh-keygen -f "/home/alberto/.ssh/known_hosts" -R 172.22.200.175\r\nECDSA host key for 172.22.200.175 has changed and you have requested strict checking.\r\nHost key verification failed.\n'})}),"\n",(0,s.jsx)(a.p,{children:"Es posible que se trate de una suplantaci\xf3n y por tanto un problema de seguridad, pero tambi\xe9n es posible que se haya realizado un cambio en el servidor que haya implicado un cambio en las claves del servicio ssh o una situaci\xf3n muy habitual hoy en d\xeda: estamos reutilizando la misma IP para un nuevo servidor."}),"\n",(0,s.jsx)(a.p,{children:"En caso de que estemos seguros de que no hay ning\xfan problema de seguridad al acceder a ese equipo remoto, debemos eliminar la antigua clave asociada a la direcci\xf3n IP (o al nombre), mediante la instrucci\xf3n:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"ssh-keygen -R 172.22.200.175\r\n# Host 172.22.200.175 found: line 88\r\n/home/alberto/.ssh/known_hosts updated.\r\nOriginal contents retained as /home/alberto/.ssh/known_hosts.old\n"})}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"forwarding",children:"Forwarding"}),"\n",(0,s.jsx)(a.p,{children:"Agent forwarding\r\nMediante esta t\xe9cnica, es posible que el cliente ssh se comunique con un agente ssh que corre un una m\xe1quina remota y sin necesidad de poner las claves privadas en \xe9l, poder saltar a otro equipo remoto no accesible directamente. Es una t\xe9cnica muy \xfatil que permite no exponer directamente los servidores a los que realmente queremos acceder mediante ssh, sino que accedemos a ellos de forma transparente usando un equipo a modo de basti\xf3n."}),"\n",(0,s.jsx)(a.p,{children:"Esta posibilidad debe estar habilitada en el servidor intermedio mediante la directiva:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"allowagentforwarding yes"})}),"\n",(0,s.jsx)(a.p,{children:"Que est\xe1 habilitada por defecto."}),"\n",(0,s.jsx)(a.p,{children:"En el cliente es necesario habilitar el par\xe1metro:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ForwardAgent yes"})}),"\n",(0,s.jsx)(a.p,{children:"X11 forwarding\r\nA trav\xe9s de la t\xe9cnica de X11 forwarding podemos ver en nuestra pantalla aplicaciones gr\xe1ficas que se ejecutan a trav\xe9s de ssh en un equipo remoto (y viceversa)."}),"\n",(0,s.jsx)(a.p,{children:"Aunque en primer lugar tiene que estar permitido en el servidor a trav\xe9s de las directivas:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"X11Forwarding yes\r\nX11DisplayOffset 10\n"})}),"\n",(0,s.jsx)(a.p,{children:"El cliente para conectarse y utilizar esta funcionalidad, deber\xe1 configurar adicionalmente la opci\xf3n:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ForwardX11 yes"})}),"\n",(0,s.jsx)(a.p,{children:"Al conectarnos por ssh podremos comprobar que est\xe1 definida la variable DISPLAY con un valor definido a trav\xe9s de la variable X11DisplayOffset, por ejemplo:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"env |grep DISPLAY"})}),"\n",(0,s.jsx)(a.p,{children:"DISPLAY=localhost:10\r\nAl ejecutar una aplicaci\xf3n en el equipo remoto sobre la conexi\xf3n ssh nos aparecer\xe1 en nuestra pantalla."}),"\n",(0,s.jsx)(a.h3,{id:"configuraci\xf3n-del-cliente",children:"Configuraci\xf3n del cliente"}),"\n",(0,s.jsx)(a.p,{children:"Existe el fichero /etc/ssh/ssh_config en el que se especifican los par\xe1metros de configuraci\xf3n generales que van a utilizar por defecto todos los clientes ssh que se ejecuten en esa m\xe1quina."}),"\n",(0,s.jsx)(a.p,{children:"Los posibles par\xe1metros que podemos definir en ese fichero se detallan en la p\xe1gina 5 del manual de ssh_config."}),"\n",(0,s.jsx)(a.h3,{id:"algunos-par\xe1metros-significativos",children:"Algunos par\xe1metros significativos"}),"\n",(0,s.jsx)(a.p,{children:"SendEnv LANG LC_*\r\nMediante este par\xe1metro se define en el equipo remoto los par\xe1metros de localizaci\xf3n del cliente, siempre que estos est\xe9n definidos all\xed. Por ejemplo, supongamos que la variable local sea LANG=es.ES.UTF-8, seguir\xe1 siendo en el equipo remoto siempre que exista, en caso contrario se pondr\xe1 la localizaci\xf3n por defecto del sistema:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"usuario@cliente:~$ echo $LANG\r\nes_ES.UTF-8\r\nusuario@cliente:~$ ssh root@servidor1\r\n\r\nThe programs included with the Debian GNU/Linux system are free software;\r\nthe exact distribution terms for each program are described in the\r\nindividual files in /usr/share/doc/*/copyright.\r\n\r\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\r\npermitted by applicable law.\r\nNo mail.\r\nLast login: Thu Feb 22 10:06:47 2018 from ...\r\nroot@servidor1:~# echo $LANG\r\nen_US.UTF-8\n"})}),"\n",(0,s.jsx)(a.h3,{id:"hashknownhosts-yesno",children:"HashKnownHosts yes|no"}),"\n",(0,s.jsx)(a.p,{children:"Para ofuscar mediante un hash la IP o el nombre de los servidores de los que almacenamos las claves p\xfablicas en el fichero ~/.ssh/known_hosts"}),"\n",(0,s.jsx)(a.h3,{id:"gssapiauthentication-yesno",children:"GSSAPIAuthentication yes|no"}),"\n",(0,s.jsx)(a.p,{children:"Para habilitar este m\xe9todo de autenticaci\xf3n, en sistemas Debian viene habilitado, aunque s\xf3lo es necesario en los casos en los que se vaya a usar este m\xe9todo de autenticaci\xf3n."}),"\n",(0,s.jsx)(a.h3,{id:"car\xe1cter-de-escape",children:"Car\xe1cter de escape"}),"\n",(0,s.jsx)(a.p,{children:"En algunas ocasiones podemos tener problemas con nuestra conexi\xf3n ssh y que la shell remota no responda a las instrucciones que mandamos, en esos casos siempre se podr\xe1 cerrar la conexi\xf3n mediante el car\xe1cter de escape que hayamos definido en nuestro cliente ssh, este caracter por defecto es \u201c~\u201d:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"EscapeChar ~"})}),"\n",(0,s.jsx)(a.p,{children:"Para ejecutarlo escribir\xedamos la secuencia \u201c~.\u201d"}),"\n",(0,s.jsx)(a.h3,{id:"forwardagent-forwardx11",children:"ForwardAgent, ForwardX11"}),"\n",(0,s.jsx)(a.p,{children:"Explicados en la secci\xf3n espec\xedfica de forwarding"}),"\n",(0,s.jsx)(a.h3,{id:"globalknownhostsfile-fichero",children:"GlobalKnownHostsFile fichero"}),"\n",(0,s.jsx)(a.p,{children:"Permite la utilizaci\xf3n de un fichero known_hosts para todos los\r\nusuarios de un equipo."}),"\n",(0,s.jsx)(a.h3,{id:"numberofpasswordprompts",children:"NumberOfPasswordPrompts"}),"\n",(0,s.jsx)(a.p,{children:"N\xfamero de intentos de acceso con contrase\xf1a. Por defecto es 3"}),"\n",(0,s.jsx)(a.h3,{id:"stricthostkeychecking-yesaskno",children:"StrictHostKeyChecking yes|ask|no"}),"\n",(0,s.jsx)(a.p,{children:"Par\xe1metro muy importante, utiliza para la gesti\xf3n de las claves p\xfablicas de los equipos remotos. La opci\xf3n por defecto es \u201cask\u201d, de manera que si no se ha almacenado previamente la clave p\xfablica se pregunta qu\xe9 hacer. En el caso de ponerla en \u201cyes\u201d, se rechazar\xe1 una conexi\xf3n si no existe previamente la clave p\xfablica y en caso de optar por la opci\xf3n \u201cno\u201d, no se har\xe1 ninguna verificaci\xf3n."}),"\n",(0,s.jsx)(a.h3,{id:"userknownhostsfile-fichero",children:"UserKnownHostsFile fichero"}),"\n",(0,s.jsx)(a.p,{children:"Fichero known_hosts de usuario, por defecto ~/.ssh/known_hosts"}),"\n",(0,s.jsx)(a.h3,{id:"configuraci\xf3n-por-usuario",children:"Configuraci\xf3n por usuario"}),"\n",(0,s.jsx)(a.p,{children:"Salvo algunos par\xe1metros generales, es poco probable que la mayor\xeda de los par\xe1metros que se pueden definir para el cliente ssh sean \xfatiles para todos los usuarios de un equipo, es mucho m\xe1s habitual que un usuario defina un fichero de configuraci\xf3n con sus propios par\xe1metros. Este fichero es ~/.ssh/config y los par\xe1metros aqu\xed definidos prevalecen sobre los generales."}),"\n",(0,s.jsx)(a.p,{children:"Se pueden definir par\xe1metros para todos los equipos remotos, pero es tambi\xe9n muy \xfatil agruparlos con el par\xe1metro Host como en el siguiente ejemplo:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"GSSAPIAuthentication no\r\n\r\nHost 192.168.1.1\r\n     User root\r\n     Port 2022\r\n     ForwardAgent yes\r\n     Identityfile ~/.ssh/id_ecdsa\r\n     StrictHostKeyChecking yes\r\n\r\nHost *.example.com\r\n     StrictHostKeyChecking no\r\n     UserKnownHostsFile=/dev/null\r\n     LogLevel QUIET\n"})}),"\n",(0,s.jsx)(a.h3,{id:"utilizar-par\xe1metros-directamente",children:"Utilizar par\xe1metros directamente"}),"\n",(0,s.jsx)(a.p,{children:"Independientemente de los par\xe1metros que est\xe9n definidos en cualquiera de las opciones anteriores, tambi\xe9n es posible utilizar par\xe1metros de forma expl\xedcita en la propia l\xednea de comandos, pas\xe1ndolos mediante el modificador \u201c-o\u201d, por ejemplo:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:'ssh -o "ForwardAgent yes" usuario@172.22.200.175'})}),"\n",(0,s.jsx)(a.h2,{id:"configuraci\xf3n-del-servidor",children:"Configuraci\xf3n del servidor"}),"\n",(0,s.jsx)(a.p,{children:"Tal como vimos en la instalaci\xf3n y configuraci\xf3n elemental del servidor ssh, podemos ver las opciones de configuraci\xf3n que se aplican a nuestro servidor mediante:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"sshd -T |less"})}),"\n",(0,s.jsx)(a.p,{children:"Vamos a comentar algunas que pueden ser interesantes porque se modifican con cierta frecuencia."}),"\n",(0,s.jsx)(a.h3,{id:"port-22",children:"Port 22"}),"\n",(0,s.jsx)(a.p,{children:"Puerto tcp en el qu va a escuchar peticiones el servidor ssh, por defecto es el 22/tcp, pero puede cambiarse sin problema."}),"\n",(0,s.jsx)(a.h3,{id:"addressfamily-anyinetinet6",children:"AddressFamily any|inet|inet6"}),"\n",(0,s.jsx)(a.p,{children:"El protocolo o protocolos de red a utilizar, puede ser inet(IPv4), inet6 (IPv6) o any(ambos) que es la opci\xf3n por defecto."}),"\n",(0,s.jsx)(a.h3,{id:"listenaddress",children:"ListenAddress"}),"\n",(0,s.jsx)(a.p,{children:"Si queremos especificar que se permitan conexiones s\xf3lo a trav\xe9s de una direcci\xf3n IP concreta (IPv4/IPv6)."}),"\n",(0,s.jsx)(a.h3,{id:"logingracetime-maxauthtries-y-maxsessions",children:"logingracetime, maxauthtries y maxsessions"}),"\n",(0,s.jsx)(a.p,{children:"Para especificar el tiempo que se espera para que el usuario se acceda con \xe9xito al sistema, el n\xfamero m\xe1ximo de veces que puede introducir la contrase\xf1a y el n\xfamero m\xe1ximo de sesiones en la misma conexi\xf3n."}),"\n",(0,s.jsx)(a.h3,{id:"loglevel-y-syslogfacility",children:"loglevel y syslogfacility"}),"\n",(0,s.jsx)(a.p,{children:"Para controlar el nivel de detalle que mostrar en los logs del sistema, as\xed como la \u201cfacility\u201d a utilizar."}),"\n",(0,s.jsx)(a.h3,{id:"hostkey",children:"hostkey"}),"\n",(0,s.jsx)(a.p,{children:"Fichero o ficheros que especifican la clave o claves privadas a utilizar por el servidor."}),"\n",(0,s.jsx)(a.h2,{id:"utilizaci\xf3n-de-scp",children:"Utilizaci\xf3n de SCP"}),"\n",(0,s.jsx)(a.p,{children:"El cliente ssh incluye tambi\xe9n el comando \u201cscp\u201d que permite copiar ficheros entre entre equipos mediante ssh y hacerlo de forma equivalente a la utilizaci\xf3n local del cl\xe1sico comando \u201ccp\u201d."}),"\n",(0,s.jsx)(a.p,{children:"No es necesario que el equipo origen o destino sea el equipo desde el que se ejecuta scp, tanto origen como destino pueden ser equipos a los que pueda acceder el usuario utilizando ssh."}),"\n",(0,s.jsx)(a.p,{children:"La sintaxis general de scp es:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"scp [[user@]host1:]file1 [[user@]host2:]file2"})}),"\n",(0,s.jsx)(a.h3,{id:"transferir-un-fichero-local-a-un-equipo-remoto",children:"Transferir un fichero local a un equipo remoto"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"scp /etc/resolv.conf usuario@172.22.200.175:resolv.conf.local"})}),"\n",(0,s.jsx)(a.p,{children:"El fichero remoto quedar\xe1 como /home/usuario/resolv.conf.local ya que : indica el punto de acceso al equipo (/home/usuario/ en este caso)"}),"\n",(0,s.jsx)(a.h3,{id:"transferir-un-fichero-desde-un-equipo-remoto-a-mi-equipo-local",children:"Transferir un fichero desde un equipo remoto a mi equipo local"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"scp root@172.22.200.175:/etc/shadow ."})}),"\n",(0,s.jsx)(a.p,{children:"Que guardar\xeda el fichero /etc/shadow del equipo remoto con el nombre shadow en el directorio en el que nos encontramos"}),"\n",(0,s.jsx)(a.h3,{id:"transferir-un-fichero-entre-dos-equipos-remotos",children:"Transferir un fichero entre dos equipos remotos"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"scp root@172.22.200.175:/etc/hosts root@172.22.200.176:/etc/hosts"})}),"\n",(0,s.jsx)(a.p,{children:"Esta opci\xf3n es muy potente y permite crear sencillos scripts para unificar configuraciones, por ejemplo imaginemos que queremos tener la misma configuraci\xf3n DNS en un conjunto de servidores, podr\xedamos hacerlo de forma sencilla y potente con ssh mediante el siguiente script:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"#!/bin/bash\r\n\r\nfor i in `seq 1 100`; do\r\n  scp root@servidor1:/etc/resolv.conf 192.168.1.$i:/etc/resolv.conf\r\ndone\n"})}),"\n",(0,s.jsx)(a.h3,{id:"bonus-track",children:"Bonus track"}),"\n",(0,s.jsx)(a.p,{children:"Si utilizamos pares de claves en las conexiones, scp autocompleta el fichero origen o destino utilizando el doble tabulador"}),"\n",(0,s.jsx)(a.h2,{id:"sftp",children:"SFTP"}),"\n",(0,s.jsx)(a.p,{children:"Al igual que scp, sftp permite transferir ficheros entre equipos remotos a trav\xe9s de SSH, aunque su principal diferencia es que sftp permite utilizarlo de una forma interactiva, al igual que el tradicional ftp, incluyendo los mismos comandos que \xe9ste. scp es mucho m\xe1s habitual utilizarlo desde l\xednea de comandos, mientras que sftp se puede utilizar bien desde la l\xednea de comandos o a trav\xe9s de uno de los m\xfaltiples clientes ftp que lo soportan."}),"\n",(0,s.jsx)(a.p,{children:"Es importante no confundir sftp (ssh ftp) con ftps que es una extensi\xf3n del protocolo ftp a\xf1adiendo ssl para el cifrado de la conexi\xf3n."}),"\n",(0,s.jsx)(a.h2,{id:"t\xfaneles-ssh",children:"T\xfaneles SSH"}),"\n",(0,s.jsx)(a.p,{children:"Esta t\xe9cnica, tambi\xe9n conocida como TCP forwarding o port forwarding, permite utilizar cualquier aplicaci\xf3n de forma segura a trav\xe9s de una conexi\xf3n ssh (de ah\xed la utilizaci\xf3n del t\xe9rmino t\xfanel)."}),"\n",(0,s.jsx)(a.h3,{id:"local-forwarding",children:"Local forwarding"}),"\n",(0,s.jsx)(a.p,{children:"Desde nuestra m\xe1quina queremos acceder a un servicio, pero este servicio o bien no es accesible (por ejemplo por un cortafuegos que lo impide), o no es seguro hacerlo desde nuestra m\xe1quina, pero tenemos acceso a otro equipo a trav\xe9s de ssh y desde ese equipo s\xed podemos acceder al servicio que queremos o es seguro hacerlo. Vamos a verlo con un ejemplo: queremos enviar un correo desde nuestro servidor de la empresa (puerto 25/tcp), pero estamos fuera y no queremos conectarnos de forma insegura, por lo que establecemos un t\xfanel ssh de la siguiente forma:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh -f -L 1025:smtp.example.com:25 remoto.example.com -N"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sh",children:"# Cerrar el proceso del tunel\r\nkill <id-proceso>\n"})}),"\n",(0,s.jsx)(a.p,{children:"Esto abrir\xe1 el puerto 1025/tcp en nuestra m\xe1quina que podremos utilizar de forma segura para enviar correo, ya que se pasar\xe1 a trav\xe9s de ssh al equipo remoto.example.com y de ah\xed al servidor smtp.example.com."}),"\n",(0,s.jsx)(a.h3,{id:"remote-forwarding",children:"Remote forwarding"}),"\n",(0,s.jsx)(a.p,{children:"Supongamos el caso contrario, en el que queremos que una m\xe1quina remota utilice un servicio de nuestra m\xe1quina, pero o bien no es accesible de forma directa o bien no es seguro hacerlo, por lo que podr\xedamos definir una conexi\xf3n ssh para realizarlo como la siguiente:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh -f -L 8080:localhost:80 remoto.example.com -N"})}),"\n",(0,s.jsx)(a.p,{children:"De esa manera desde el equipo remoto, quien acceda al puerto 8080/tcp estar\xe1 accesiendo al puerto 80/tcp de nuestra m\xe1quina a trav\xe9s de un t\xfanel ssh."}),"\n",(0,s.jsx)(a.p,{children:"La directiva \u201cGatewayPorts yes|no\u201d limita el puerto 8080 del caso anterior a que se pueda acceder s\xf3lo desde el propio equipo remoto, o bien desde cualquier equipo."}),"\n",(0,s.jsx)(a.h3,{id:"forwarding-din\xe1mico",children:"Forwarding din\xe1mico"}),"\n",(0,s.jsx)(a.p,{children:"Mediante este mecanismo, lo que hacemos es crear un servidor SOCKS en nuestro equipo, que permite utilizar desde nuestra m\xe1quina cualquier cliente que soporte este mecanismo, en particular un navegador web. Definir\xedamos un servidor socks local que sale a trav\xe9s de un t\xfanel ssh con un equipo remoto de la siguiente forma:"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"ssh -D 8080 -f -C -q -N remote.example.com"})})]})}function u(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>c});var s=n(6540);const r={},i=s.createContext(r);function o(e){const a=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:a},e.children)}}}]);