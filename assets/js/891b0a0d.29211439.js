"use strict";(self.webpackChunkrubenfgr_website=self.webpackChunkrubenfgr_website||[]).push([[7262],{1361:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>o});var s=e(4848),i=e(8453);const c={title:"Dockerfiles"},l=void 0,a={id:"docker/dockerfiles",title:"Dockerfiles",description:"Apache PHP TLS SSL",source:"@site/docs/docker/dockerfiles.md",sourceDirName:"docker",slug:"/docker/dockerfiles",permalink:"/docs/docker/dockerfiles",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Dockerfiles"},sidebar:"tutorialSidebar",previous:{title:"Aliases",permalink:"/docs/docker/aliases"},next:{title:"Documentaci\xf3n",permalink:"/docs/category/documentaci\xf3n"}},t={},o=[{value:"Apache PHP TLS SSL",id:"apache-php-tls-ssl",level:2},{value:"Crear usuario",id:"crear-usuario",level:2},{value:"Buenas pr\xe1cticas",id:"buenas-pr\xe1cticas",level:2},{value:"CentOS systemd",id:"centos-systemd",level:2},{value:"Dockerfile FULL",id:"dockerfile-full",level:2},{value:"Dockerfile FULL 2",id:"dockerfile-full-2",level:2},{value:"Escenarios m\xfaltiples",id:"escenarios-m\xfaltiples",level:2},{value:"NGINX PHP FPM",id:"nginx-php-fpm",level:2}];function d(n){const r={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"apache-php-tls-ssl",children:"Apache PHP TLS SSL"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Archivos\r\nDockerfile\r\ndocker.csr # Solicitud de firma de certificado\r\ndocker.key # Clave privada del certificado\r\nno-subir.txt # Fichero ignorado por .dockerignore\r\n.dockerignore\r\n/web # Directorio con los ficheros de la p\xe1gina web\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Dockerfile"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'FROM centos:7\r\n\r\nENV a a\r\n\r\nRUN \\\r\nyum -y install \\\r\nhttpd \\\r\nphp \\\r\nphp-cli \\\r\nphp-common \\\r\nmod_ssl \\\r\nopenssl\r\n\r\nRUN echo "<?php phpinfo(); ?>" > /var/www/html/hola.php\r\n\r\nCOPY docker.key /docker.key\r\nCOPY docker.csr /docker.csr\r\nCOPY ssl.conf /etc/httpd/conf.d/default.conf\r\nCOPY startbootstrap-grayscale-gh-pages /var/www/html\r\n\r\nEXPOSE 443\r\n\r\nCMD apachectl -DFOREGROUND\n'})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"dockerignore"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"no-subir.txt\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"SSL Conf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-conf",children:"<VirtualHost *:443>\r\nServerName localhost\r\nDocumentRoot /var/www/html\r\nSSLEngine on\r\nSSLCertificateFile /docker.csr\r\nSSLCertificateKeyFile /docker.key\r\n</VirtualHost>\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"docker.csr"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Tu solicitud de certificado .csr\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"docker.key"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Tu clave privada del certificado\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"crear-usuario",children:"Crear usuario"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"FROM centos\r\n\r\nENV prueba 1234\r\n\r\nRUN useradd ricardo\n"})}),"\n",(0,s.jsx)(r.h2,{id:"buenas-pr\xe1cticas",children:"Buenas pr\xe1cticas"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'FROM nginx\r\n\r\nENV dir /usr/share/nginx/html/test.txt\r\n\r\nRUN \\\r\n  echo "1" >> $dir && \\\r\n  echo "2" >> $dir && \\\r\n  echo "3" >> $dir\n'})}),"\n",(0,s.jsx)(r.h2,{id:"centos-systemd",children:"CentOS systemd"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'FROM centos:latest\r\nENV container docker\r\nRUN (cd /lib/systemd/system/sysinit.target.wants/; for i in *; do [ $i == \\\r\nsystemd-tmpfiles-setup.service ] || rm -f $i; done); \\\r\nrm -f /lib/systemd/system/multi-user.target.wants/*;\\\r\nrm -f /etc/systemd/system/*.wants/*;\\\r\nrm -f /lib/systemd/system/local-fs.target.wants/*; \\\r\nrm -f /lib/systemd/system/sockets.target.wants/*udev*; \\\r\nrm -f /lib/systemd/system/sockets.target.wants/*initctl*; \\\r\nrm -f /lib/systemd/system/basic.target.wants/*;\\\r\nrm -f /lib/systemd/system/anaconda.target.wants/*;\r\nVOLUME [ "/sys/fs/cgroup" ]\r\nCMD ["/usr/sbin/init"]\n'})}),"\n",(0,s.jsx)(r.h2,{id:"dockerfile-full",children:"Dockerfile FULL"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Archivos\r\nDockerfile\r\n/web # Tus ficheros de la p\xe1gina web\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'FROM nginx\r\n\r\nRUN useradd ruperto\r\n\r\nCOPY startbootstrap /usr/share/nginx/html\r\n\r\nENV archivo docker\r\n\r\nWORKDIR /usr/share/neginx/html\r\n\r\nRUN echo "$archivo" > /usr/share/nginx/html/env.html\r\n\r\nEXPOSE 90\r\n\r\nLABEL version=1\r\n\r\nUSER ruperto\r\n\r\nRUN echo "Yo soy $(whoami)" > /tmp/yo.html\r\n\r\nUSER root\r\n\r\nRUN cp /tmp/yo.html /usr/share/nginx/html/docker.html\r\n\r\nVOLUME /var/log/nginx\r\n\r\nCMD nginx -g \'daemon off;\'\n'})}),"\n",(0,s.jsx)(r.h2,{id:"dockerfile-full-2",children:"Dockerfile FULL 2"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Archivos\r\nDockerfile\r\nrun.sh\r\n/web\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Dockerfile"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'FROM ubuntu:latest\r\n\r\nLABEL version=1.0\r\nLABEL descripcion="This is an apache image"\r\nLABEL vendor=yo\r\n\r\nRUN apt-get update\r\n\r\nRUN apt-get install apache2 -y\r\n\r\nWORKDIR /var/www/html\r\n\r\nCOPY bootstrap .\r\n\r\nENV contenido prueba\r\n\r\nRUN echo "$contenido" > /var/www/html/prueba.html\r\n\r\nRUN echo "$(whoami)" > /var/www/html/user1.html\r\n\r\nRUN useradd ruperto\r\n\r\nRUN chown ruperto /mnt -R\r\n\r\nUSER ruperto\r\n\r\nRUN echo "$(whoami)" > /mnt/user2.html\r\n\r\nUSER root\r\n\r\nRUN cp /mnt/user2.html /var/www/html/\r\n\r\nCOPY run.sh /run.sh\r\n\r\nCMD sh /run.sh\r\n\n'})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"run.sh"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\n\r\necho "Iniciando container..."\r\necho "INICIADO!!" > /var/www/html/ini.html\r\napachectl -DFOREGROUND\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"escenarios-m\xfaltiples",children:"Escenarios m\xfaltiples"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"FROM maven:latest as builder\r\n\r\nCOPY app /app # app Java\r\n\r\nRUN cd /app && mvn package\r\n\r\nFROM openjdk:8-alpine\r\n\r\nCOPY --from=builder /app/target/jb-hello-world-maven-0.1.0.jar /opt/app.jar\r\n\r\nCMD java -jar /opt/app.jar\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"FROM centos as test\r\n\r\nRUN fallocate -l 10M /opt/file1\r\n\r\nRUN fallocate -l 10M /opt/file2\r\n\r\nRUN fallocate -l 10M /opt/file3\r\n\r\nFROM alpine\r\n\r\nCOPY --from=test /opt/file3 /opt/myfile\n"})}),"\n",(0,s.jsx)(r.h2,{id:"nginx-php-fpm",children:"NGINX PHP FPM"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"# Archivos/directorios\r\n/bin\r\n    start.sh\r\n/conf\r\n    nginx.conf\r\n    nginx.repo\r\nDockerfile\r\nindex.php\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"start.sh"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"#!/bin/bash\r\n\r\n# Starts php process in background\r\n\r\n/usr/sbin/php-fpm -c /etc/php/fpm\r\n\r\n# Starts nginx daemon\r\n\r\nnginx -g 'daemon off;'\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"nginx.conf"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:'server {\r\n  listen       80;\r\n  server_name  localhost;\r\n  root         /var/www/html;\r\n  index        index.php;\r\n  access_log   /var/log/nginx/nginx-access.log;\r\n  error_log    /var/log/nginx/nginx-error.log;\r\n\r\n   gzip on;\r\n   gzip_static on;\r\n   gzip_disable "msie6";\r\n   gzip_http_version 1.1;\r\n   gzip_vary on;\r\n   gzip_comp_level 6;\r\n   gzip_proxied any;\r\n   gzip_buffers 16 8k;\r\n   gzip_types\r\n     text/plain\r\n     text/css\r\n     text/x-js\r\n     text/javascript\r\n     application/json\r\n     application/x-javascript\r\n     application/javascript;\r\n\r\n\r\n  location = /favicon.ico {\r\n    log_not_found off;\r\n    access_log off;\r\n  }\r\n\r\n  location = /robots.txt {\r\n    allow all;\r\n    log_not_found off;\r\n    access_log off;\r\n  }\r\n\r\n  location / {\r\n\r\n    try_files $uri $uri/ /index.php?$args;\r\n\r\n  }\r\n\r\n  location ~ \\.php$ {\r\n\r\n    try_files $uri =404;\r\n    include /etc/nginx/fastcgi_params;\r\n    fastcgi_pass 127.0.0.1:9000;\r\n    fastcgi_index index.php;\r\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\r\n    fastcgi_param PATH_INFO $fastcgi_script_name;\r\n    fastcgi_intercept_errors on;\r\n\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"nginx.repo"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"[nginx]\r\nname=nginx repo\r\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\r\ngpgcheck=0\r\nenabled=1\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Dockerfile"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"FROM centos:7\r\n\r\nCOPY ./conf/nginx.repo /etc/yum.repos.d/nginx.repo\r\n\r\nRUN                                                                          \\\r\n  yum -y install nginx --enablerepo=nginx                                 && \\\r\n  yum -y install https://centos7.iuscommunity.org/ius-release.rpm         && \\\r\n  yum -y install                                                             \\\r\n    php71u-fpm                                                               \\\r\n    php71u-cli                                                               \\\r\n    php71u-mysqlnd                                                           \\\r\n    php71u-soap                                                              \\\r\n    php71u-xml                                                               \\\r\n    php71u-zip                                                               \\\r\n    php71u-json                                                              \\\r\n    php71u-mcrypt                                                            \\\r\n    php71u-mbstring                                                          \\\r\n    php71u-zip                                                               \\\r\n    php71u-gd                                                                \\\r\n     --enablerepo=ius && yum clean all\r\n\r\nEXPOSE 80 443\r\n\r\nVOLUME /var/www/html /var/log/nginx /var/log/php-fpm /var/lib/php-fpm\r\n\r\nCOPY ./conf/nginx.conf /etc/nginx/conf.d/default.conf\r\n\r\nCOPY ./bin/start.sh /start.sh\r\n\r\nCOPY index.php /var/www/html/index.php\r\n\r\nRUN chmod +x /start.sh\r\n\r\nCMD /start.sh\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"index.php"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sh",children:"<?php phpinfo(); ?>\n"})})]})}function p(n={}){const{wrapper:r}={...(0,i.R)(),...n.components};return r?(0,s.jsx)(r,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,r,e)=>{e.d(r,{R:()=>l,x:()=>a});var s=e(6540);const i={},c=s.createContext(i);function l(n){const r=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function a(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),s.createElement(c.Provider,{value:r},n.children)}}}]);