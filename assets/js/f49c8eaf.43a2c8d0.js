"use strict";(self.webpackChunkrubenfgr_website=self.webpackChunkrubenfgr_website||[]).push([[1633],{5352:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});var s=r(4848),i=r(8453);const o={title:"Ejemplo Node + Angular",sidebar_position:3},a=void 0,t={id:"cloud/firebase/cloud_messaging/example_node_angular",title:"Ejemplo Node + Angular",description:"Incluye el proyecto de Node (back) y Angular (front)",source:"@site/docs/cloud/firebase/cloud_messaging/example_node_angular.mdx",sourceDirName:"cloud/firebase/cloud_messaging",slug:"/cloud/firebase/cloud_messaging/example_node_angular",permalink:"/docs/cloud/firebase/cloud_messaging/example_node_angular",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Ejemplo Node + Angular",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Introducci\xf3n",permalink:"/docs/cloud/firebase/cloud_messaging/intro"},next:{title:"CMS",permalink:"/docs/category/cms"}},l={},c=[{value:"Configurar FCM en la Consola de Firebase",id:"configurar-fcm-en-la-consola-de-firebase",level:2},{value:"Configurar backend (Node)",id:"configurar-backend-node",level:2},{value:"Configurar frontend (Angular)",id:"configurar-frontend-angular",level:2},{value:"Obtener token en front y usar en back",id:"obtener-token-en-front-y-usar-en-back",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.admonition,{title:"Repositorio",type:"info",children:[(0,s.jsx)(e.p,{children:"Incluye el proyecto de Node (back) y Angular (front)"}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/rubenfgr-doc/firebase-fcm-node-angular",children:"https://github.com/rubenfgr-doc/firebase-fcm-node-angular"})})]}),"\n",(0,s.jsx)(e.h2,{id:"configurar-fcm-en-la-consola-de-firebase",children:"Configurar FCM en la Consola de Firebase"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Entramos al apartado de proyectos de Firebase"}),"\n",(0,s.jsx)(e.li,{children:"Agregamos un nuevo proyecto con el nombre: test-push-notifications"}),"\n",(0,s.jsx)(e.li,{children:"Deseleccionamos Google Analytics y lo creamos"}),"\n",(0,s.jsx)(e.li,{children:"Seleccionamos Participaci\xf3n / Messaging"}),"\n",(0,s.jsx)(e.li,{children:"Agregamos una App Web"}),"\n",(0,s.jsx)(e.li,{children:"Sobrenombre: Test Push Notifications"}),"\n",(0,s.jsx)(e.li,{children:'Clic en "Registrar app"'}),"\n",(0,s.jsx)(e.li,{children:"En este punto no hacemos nada m\xe1s (volvemos a la consola)"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"configurar-backend-node",children:"Configurar backend (Node)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:'En la consola de firebase, vamos a "Descripci\xf3n general" > Configuraci\xf3n del proyecto'}),"\n",(0,s.jsx)(e.li,{children:'Pesta\xf1a de "Cuentas de servicio"'}),"\n",(0,s.jsx)(e.li,{children:'Clic en "Administrar permisos de la cuenta de servicio"'}),"\n",(0,s.jsx)(e.li,{children:"En el men\xfa, seleccionamos APIs y servicios > APIs y servicios habilitados > HABILITAR APIS Y SERVICIOS"}),"\n",(0,s.jsx)(e.li,{children:'Buscamos "messaging"'}),"\n",(0,s.jsx)(e.li,{children:"Habilitamos: Cloud Messaging, Firebase Cloud Messaging API y FCM Registration API"}),"\n",(0,s.jsx)(e.li,{children:"En la consola, seleccionamos Node.js"}),"\n",(0,s.jsx)(e.li,{children:"Clic en Generar nueva clave privada"}),"\n",(0,s.jsx)(e.li,{children:"Renombramos el .json descargado a key.json"}),"\n",(0,s.jsx)(e.li,{children:"Creamos el proyecto de backend"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"mkdir test-push-notifications-back\r\ncd test-push-notifications-back\r\nnpm init -y\r\ntouch index.js\r\nnpm i firebase@10.1.0\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Copiamos key.json en la ra\xedz del proyecto"}),"\n",(0,s.jsx)(e.li,{children:"Agregamos el siguiente c\xf3digo en el index.js"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:'title="index.js"',children:'var admin = require("firebase-admin");\r\n\r\nvar serviceAccount = require("./key.json");\r\n\r\nvar app = admin.initializeApp({\r\n  credential: admin.credential.cert(serviceAccount),\r\n});\r\n\r\nadmin\r\n  .messaging(app)\r\n  .send({\r\n    token: "<AQUI-EL-TOKEN-DE-CLIENTE>",\r\n    data: { title: "T\xedtulo", message: "Mensaje" },\r\n  })\r\n  .then((v) => {\r\n    console.log("Ok", v);\r\n  })\r\n  .catch((err) => {\r\n    console.log("KO", err);\r\n  });\n'})}),"\n",(0,s.jsx)(e.h2,{id:"configurar-frontend-angular",children:"Configurar frontend (Angular)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Iniciamos un proyecto de Angular"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"ng new test-push-notifications-front\r\ncd test-push-notifications-front\r\ntouch src/firebase-messaging-sw.js\r\nnpm i firebase@10.1.0\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Modificamos el angular.json"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Agregamos el archivo firebase-messaging-sw.js en los assets."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",metastring:"title=angular.json",children:'{\r\n  ...\r\n  "projects": {\r\n    "front": {\r\n      ...\r\n      "architect": {\r\n        "build": {\r\n          ...\r\n          "options": {\r\n            ...\r\n            "assets": [\r\n              "src/favicon.ico",\r\n              "src/assets",\r\n              "src/firebase-messaging-sw.js"\r\n            ],\r\n            ...\r\n          },\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Agregamos el siguiente c\xf3digo en firebase-messaging-sw.js"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"La configuraci\xf3n la obtenemos en la consola de firebase > Configuraci\xf3n del proyecto > General"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:"title=firebase-messaging-sw.js",children:'importScripts(\r\n  "https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"\r\n);\r\nimportScripts(\r\n  "https://www.gstatic.com/firebasejs/10.1.0/firebase-messaging-compat.js"\r\n);\r\n\r\n// Initialize the Firebase app in the service worker by passing the generated config\r\nvar firebaseConfig = {\r\n  apiKey: "AIzaSyD9CxihmhjZYx7coxsRvjNY1WOUCumJGDU",\r\n  authDomain: "push-notifications-96ab3.firebaseapp.com",\r\n  projectId: "push-notifications-96ab3",\r\n  storageBucket: "push-notifications-96ab3.appspot.com",\r\n  messagingSenderId: "265925964312",\r\n  appId: "1:265925964312:web:e05d6f5246c1d9eb5a496d",\r\n  measurementId: "G-QBJE50HT2H",\r\n};\r\n\r\nconst firebaseApp = firebase.initializeApp(firebaseConfig);\r\n\r\nconst messaging = firebase.messaging(firebaseApp);\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Modificamos el main.ts"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",metastring:"title=main.ts",children:'import { platformBrowserDynamic } from "@angular/platform-browser-dynamic";\r\n\r\nimport { AppModule } from "./app/app.module";\r\n\r\n// Import the functions you need from the SDKs you need\r\nimport { initializeApp } from "firebase/app";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: "AIzaSyD9CxihmhjZYx7coxsRvjNY1WOUCumJGDU",\r\n  authDomain: "push-notifications-96ab3.firebaseapp.com",\r\n  projectId: "push-notifications-96ab3",\r\n  storageBucket: "push-notifications-96ab3.appspot.com",\r\n  messagingSenderId: "265925964312",\r\n  appId: "1:265925964312:web:e05d6f5246c1d9eb5a496d",\r\n  measurementId: "G-QBJE50HT2H",\r\n};\r\n\r\ninitializeApp(firebaseConfig);\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch((err) => console.error(err));\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Modificamos el app.component.ts"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",metastring:"title=app.component.ts",children:'import { Component, OnInit } from "@angular/core";\r\nimport {\r\n  getMessaging,\r\n  getToken,\r\n  onMessage,\r\n  Messaging,\r\n} from "@firebase/messaging";\r\n\r\n@Component({\r\n  selector: "app-root",\r\n  templateUrl: "./app.component.html",\r\n  styleUrls: ["./app.component.scss"],\r\n})\r\nexport class AppComponent implements OnInit {\r\n  title = "FCM Received Message";\r\n  payload = {};\r\n  token = "";\r\n\r\n  ngOnInit(): void {\r\n    const messaging: Messaging = getMessaging();\r\n\r\n    getToken(messaging, {\r\n      vapidKey:\r\n        "BAaTt4I12tsLSyl11S8hENePANoCp8FfzrjaPhczENU6Gnv9ZScgzOJPuy_-GwpbCogEg5ZxkEQLSzeOzVIckx8",\r\n    })\r\n      .then((currentToken) => {\r\n        if (currentToken) {\r\n          // Send the token to your server and update the UI if necessary\r\n          // ...\r\n          console.log("currentToken: ", currentToken);\r\n          this.token = currentToken;\r\n        } else {\r\n          // Show permission request UI\r\n          console.log(\r\n            "No registration token available. Request permission to generate one."\r\n          );\r\n          // ...\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.log("An error occurred while retrieving token. ", err);\r\n        // ...\r\n      });\r\n\r\n    onMessage(messaging, (payload) => {\r\n      console.log("Message received (foreground): ", payload);\r\n      this.payload = payload;\r\n    });\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Modificamos el app.component.html"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-html",metastring:"title=app.component.html",children:"<h1>{{ title }}</h1>\r\n<h2>Token</h2>\r\n<pre>\r\n{{ token }}\r\n</pre>\r\n<h2>Payload</h2>\r\n<pre>\r\n  {{ payload | json }}\r\n</pre>\n"})}),"\n",(0,s.jsx)(e.h2,{id:"obtener-token-en-front-y-usar-en-back",children:"Obtener token en front y usar en back"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Front. Ejecutamos el proyecto y copiamose el token que se imprimir\xe1 por html o consola"}),"\n",(0,s.jsx)(e.li,{children:"Back. Copiamos el token en: AQUI-EL-TOKEN-DE-CLIENTE"}),"\n",(0,s.jsx)(e.li,{children:"Ejecutamos el back"}),"\n",(0,s.jsx)(e.li,{children:"En este momento el front a tenido que recibir el mensaje del back y mostrarlo en pantalla"}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>a,x:()=>t});var s=r(6540);const i={},o=s.createContext(i);function a(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);